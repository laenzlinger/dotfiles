# Arch Linux Recovery Guide (Restic + LVM + Systemd-boot)

This guide provides the exact steps to reconstruct the Arch Linux system using these resticprofile backups.

ðŸ›  1. Environment Preparation
Boot from the Arch Linux ISO.

```bash

# 1. Initialize LVM (If using a new/wiped disk)

pvcreate /dev/sdX
vgcreate vg00 /dev/sdX
lvcreate -L 100G -n root vg00

# 2. Format and Mount

mkfs.ext4 /dev/mapper/vg00-root
mount /dev/mapper/vg00-root /mnt

# 3. Mount EFI Partition

mkdir -p /mnt/boot
mount /dev/sdX1 /mnt/boot
```

ðŸ’¾ 2. Restore Data (Restic)
Since the ISO lacks your systemd credentials, restore manually using your repo password.

```bash
export REPO="local:/mnt/path-to-your-backup"

# Restore core system directories and your home

restic -r $REPO restore latest --target /mnt \
    --include /etc \
    --include /boot \
    --include /root \
    --include /home/laenzi

```

ðŸ”§ 3. System Reconstruction
Run these steps to link the restored files to the current hardware.
Fix Partition Mapping (FSTAB)
Run this outside the chroot to capture the new LVM UUIDs.

```bash

# Use [genfstab](https://man.archlinux.org)

genfstab -U /mnt > /mnt/etc/fstab
```

Chroot and Re-sync

```bash
arch-chroot /mnt

# 1. Reinstall packages (fixes /usr and /bin)

# Uses the list generated by your resticprofile run-before

pacman -Syu --needed --overwrite '*' - < /home/laenzi/.config/pacman/pkglist.txt

# Restore aur packages with yay
yay -S --needed --overwrite '*' - < /home/laenzi/.config/pacman/foreignpkglist.txt

# 2. Repair systemd-boot

# Re-registers the bootloader with the [UEFI NVRAM](https://wiki.archlinux.org)

bootctl install

# 3. Update the Boot Entry UUID

# Get new UUID: blkid -s UUID -o value /dev/mapper/vg00-root

vi /boot/loader/entries/arch.conf

# Update the 'options' line: root=UUID=<NEW_UUID> rw

# 4. Rebuild Initramfs (Crucial for LVM support)

# Ensure /etc/mkinitcpio.conf contains the 'lvm2' hook

mkinitcpio -P

exit
reboot
```
